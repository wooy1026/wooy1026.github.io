<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>μΊ΅μ¤ν†¤+ μΈν„°νμ΄μ¤</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <header>
        π“¦ CAPSTONE+ λ¬Έμ„λ°°λ‹¬ μμ¨μ£Όν–‰ μ‹μ¤ν…
    </header>
    <main>
        <div class="left_info_zone">
            <div id="current-position" class="info_box">
                <div class="time_row">
                    <strong>[ν„μ¬μ‹κ°„]</strong> : <span id="current_time">(ν„μ¬μ‹κ°„μ΄ ν‘μ‹λ©λ‹λ‹¤)</span>
                </div>
                <div id="map" style="width:100%;height:220px;margin-top:10px;"></div>
            </div>
            <div id="target_goal" class="info_box">
                <strong>[ν„μ¬ λ©ν‘ λ„μ°©μ§€] </strong> <span id="goal_value">(ν„μ¬ λ©ν‘ λ„μ°©μ§€ λ…μ΄ λ“¤μ–΄κ°‘λ‹λ‹¤)</span>
                <strong>[μ§„ν–‰λ¥ ] </strong> <span id="goal_percent">(ν„μ¬ μ§„ν–‰λ¥ μ΄ λ“¤μ–΄κ°‘λ‹λ‹¤)</span>
            </div>
        </div>
        <div class="button_zone">
            <button class="receiver_button">
                <div class="receiver_name">(λ¬Έμ„ μλ Ήμ μ΄λ¦„μ΄ λ“¤μ–΄κ°‘λ‹λ‹¤)</div>
                <div class="complete_text">μλ Ήμ™„λ£μ‹ λ²„νΌμ„ λλ¬μ£Όμ„Έμ”</div>
            </button>
            <div class ="bottom_buttons">
                <button class="extra_button_1">μ¶”κ°€ λ²„νΌ 1</button>
                <button class="extra_button_2">μ¶”κ°€ λ²„νΌ 2</button>
            </div>
        </div>
    </main>
    <footer>
        &copy; 2025 CAPSTONE+ Team. λ„νλ”λ¦¬. All rights reserved.
    </footer>
<script>
document.querySelector('.extra_button_1').addEventListener('click', function() {
    fetch('/button1', {method: 'POST'});
});
document.querySelector('.extra_button_2').addEventListener('click', function() {
    fetch('/button2', {method: 'POST'});
});
document.querySelector('.receiver_button').addEventListener('click', function() {
    fetch('/receiver', {method: 'POST'});
});

setInterval(() => {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('ko-KR', { hour12: false });
    document.getElementById('current_time').innerText = timeStr;
}, 1000);

// μ§€λ„ μƒμ„± λ° μ‹¤μ‹κ°„ μΆν‘ λ°μ
let map, marker;
fetch('/coord').then(res => res.json()).then(data => {
    map = L.map('map', { maxZoom: 19 }).setView([data.lat, data.lng], 19);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Β© OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);
    marker = L.marker([data.lat, data.lng]).addTo(map);
});

setInterval(async () => {
    const res = await fetch('/coord');
    const data = await res.json();
    if (marker && map) {
        marker.setLatLng([data.lat, data.lng]);
        map.setView([data.lat, data.lng]);
    }
}, 1000);

// μ§„ν–‰λ¥  μ‹¤μ‹κ°„ λ°μ
setInterval(async () => {
    const res = await fetch('/progress');
    const data = await res.json();
    document.getElementById('goal_percent').innerText = data.percent + "%";
}, 1000);

// λ©ν‘ λ„μ°©μ§€ μ‹¤μ‹κ°„ λ°μ
setInterval(async () => {
    const res = await fetch('/goal');
    const data = await res.json();
    document.getElementById('goal_value').innerText = data.goal;
}, 1000);

// μμ‹ μ μ΄λ¦„ μ‹¤μ‹κ°„ λ°μ
setInterval(async () => {
    const res = await fetch('/receiver_name');
    const data = await res.json();
    document.querySelector('.receiver_name').innerText = data.name;
}, 1000);
</script>
</body>
</html>